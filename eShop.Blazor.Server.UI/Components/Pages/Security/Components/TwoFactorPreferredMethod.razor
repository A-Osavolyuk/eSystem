<MudPaper Outlined="true" Class="pa-5">
    <MudStack Spacing="1">
        <MudTextM3 Typo="TypoM3.Title" Size="Size.Medium" Class="fw-bold">
            Preferred 2FA method
        </MudTextM3>
        <MudTextM3 Typo="TypoM3.Body" Size="Size.Small" Class="opacity-50">
            Set your preferred method to use for two-factor authentication when signing into eAccount.
        </MudTextM3>
        <MudGrid Spacing="1">
            <MudItem xs="3">
                <MudSelectExtended
                    T="string"
                    @bind-Value="Type"
                    Variant="Variant.Outlined"
                    Margin="Margin.Dense"
                    AnchorOrigin="Origin.BottomCenter"
                    Immediate="true"
                    Disabled="@(Model.Providers.Count == 1)">
                    @foreach (var provider in Model.Providers.Where(x => x.Method != TwoFactorMethod.Sms))
                    {
                        if (provider.Method == TwoFactorMethod.AuthenticatorApp)
                        {
                            <MudSelectItemExtended 
                                T="string" 
                                Value="@TwoFactorTypes.AuthenticatorApp" 
                                Text="Authenticator app"/>
                        }

                        if (provider.Method == TwoFactorMethod.Passkey)
                        {
                            <MudSelectItemExtended 
                                T="string" 
                                Value="@TwoFactorTypes.Passkeys" 
                                Text="Passkey"/>
                        }
                    }
                </MudSelectExtended>
            </MudItem>
            <MudItem xs="9">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1" Class="mt-3">
                    <MudIcon Icon="@Icons.Material.Outlined.Info" Size="Size.Small"></MudIcon>
                    @if (Type == TwoFactorTypes.AuthenticatorApp)
                    {
                        <MudTextM3 Typo="TypoM3.Body" Size="Size.Small" Class="opacity-50">
                            Authenticator app will be used with password.
                        </MudTextM3>
                    }
                    else
                    {
                        <MudTextM3 Typo="TypoM3.Body" Size="Size.Small" Class="opacity-50">
                            Passkeys should be used primarily for standalone, password-less authentication.
                        </MudTextM3>
                    }
                </MudStack>
            </MudItem>
        </MudGrid>
    </MudStack>
</MudPaper>

@code {
    [Parameter] public TwoFactorData Model { get; set; } = new();

    private string? Type { get; set; }

    protected override void OnInitialized()
    {
        var primaryProvider = Model.Providers.First(x => x.IsPrimary);
        Type = primaryProvider.Method switch
        {
            TwoFactorMethod.AuthenticatorApp => TwoFactorTypes.AuthenticatorApp,
            TwoFactorMethod.Passkey => TwoFactorTypes.Passkeys,
            _ => throw new NotSupportedException("Unsupported 2FA type")
        };
    }

}