<MudStack Spacing="3">
    <MudText Typo="Typo.h5">Two-factor authentication (2FA)</MudText>
    @if (Model.Enabled)
    {
        <MudPaper Outlined="true" Class="pa-5">
            <MudStack Spacing="3">
                <MudStack Spacing="2">
                    @foreach (var provider in Model.Providers)
                    {
                        <MudStack Spacing="1">
                            <MudStack Row="true" Spacing="1">
                                <MudText Style="padding-top: 5px"> With @provider.Name</MudText>
                                @if (provider.Subscribed)
                                {
                                    <MudChip
                                        T="string"
                                        Size="Size.Small"
                                        Variant="Variant.Outlined"
                                        Color="Color.Success">
                                        Enabled
                                    </MudChip>
                                    <MudSpacer/>
                                    <MudTooltip Text="Disable">
                                        <MudIconButton
                                            Color="Color.Error"
                                            Class="pt-1"
                                            Icon="@Icons.Material.Filled.Close"
                                            Variant="Variant.Outlined"
                                            ButtonType="ButtonType.Button"
                                            Href="@($"/account/2fa/provider/disable?provider={provider}")"/>
                                    </MudTooltip>
                                }
                                else
                                {
                                    <MudChip
                                        T="string"
                                        Size="Size.Small"
                                        Variant="Variant.Outlined"
                                        Color="Color.Error">
                                        Disabled
                                    </MudChip>
                                    <MudSpacer/>
                                    <MudTooltip Text="Enable">
                                        <MudIconButton
                                            Color="Color.Success"
                                            Class="pt-1"
                                            Icon="@Icons.Material.Filled.Check"
                                            Variant="Variant.Outlined"
                                            ButtonType="ButtonType.Button"
                                            Href="@OnSubscribe(provider.Name)"/>
                                    </MudTooltip>
                                }
                            </MudStack>
                            @if (provider.UpdateDate.HasValue)
                            {
                                if (provider.Subscribed)
                                {
                                    <MudText
                                        Class="opacity-50"
                                        Style="bottom: -15px"
                                        Typo="Typo.caption">
                                        Enabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                                    </MudText>
                                }
                                else
                                {
                                    <MudText
                                        Class="opacity-50"
                                        Style="bottom: -18px"
                                        Typo="Typo.caption">
                                        Disabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                                    </MudText>
                                }
                            }
                        </MudStack>
                    }
                </MudStack>
            </MudStack>
        </MudPaper>
    }
    else
    {
        <MudDivider/>
        <MudStack Justify="Justify.Center" AlignItems="AlignItems.Center">
            <MudStack Spacing="1" Justify="Justify.Center" AlignItems="AlignItems.Center"> 
                <MudIcon Icon="@Icons.Material.Filled.Lock"/>
                <MudText Align="Align.Center" Typo="Typo.h6">
                    Two-factor authentication is not enabled yet.
                </MudText>
                <MudText Align="Align.Center" Class="opacity-50">
                    Two-factor authentication adds an additional layer of security
                    to your account by requiring more than just a password to sign in.
                </MudText>
            </MudStack>
            <MudButton
                Variant="Variant.Filled"
                Color="Color.Success"
                ButtonType="ButtonType.Button"
                Href=@($"/account/login/enable?type={LoginTypes.TwoFactor}")>
                Enable two-factor authentication
            </MudButton>
        </MudStack>
    }
</MudStack>

@code {
    [Parameter] 
    public TwoFactorData Model { get; set; } = new();

    private string OnSubscribe(string provider)
    {
        return provider == ProviderTypes.Authenticator
            ? "/account/2fa/authenticator/enable"
            : $"/account/2fa/provider/enable?provider={provider}";
    }

}