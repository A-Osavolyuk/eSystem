@page "/Error"

@using System.Web
@using eShop.Infrastructure.Routing
@inherits PageBase

<Title Text="Error" />

<MudGrid Justify="Justify.Center">
    <MudItem xs="6">
        @switch (Code)
        {
            case StatusCodes.Status404NotFound:
            {
                <MudText Align="Align.Center" Typo="Typo.h4">Page not found</MudText>
                <MudText Align="Align.Center" Typo="Typo.h5">Sorry, the page you are looking for does not exist.</MudText>
                <MudLink
                    Style="text-align:center"
                    Class="d-block"
                    Typo="Typo.h5"
                    OnClick="@(async () => await RouteManager.NavigateAsync("/products", true))">
                    To main page
                </MudLink>
                break;
            }
            case StatusCodes.Status403Forbidden:
            {
                <MudText Align="Align.Center" Typo="Typo.h4">Access denied</MudText>
                <MudText Align="Align.Center" Typo="Typo.h5">You do not have access to this resource.</MudText>
                if (string.IsNullOrEmpty(ReturnUrl))
                {
                    <MudLink
                        Style="text-align:center"
                        Class="d-block"
                        Typo="Typo.h5"
                        OnClick="@(async () => await RouteManager.NavigateAsync("/products"))">
                        To main page
                    </MudLink>
                }
                else
                {
                    <MudLink
                        Style="text-align:center"
                        Class="d-block"
                        Typo="Typo.h5"
                        OnClick="@(async () => await RouteManager.NavigateAsync(ReturnUrl, true))">
                        Go back
                    </MudLink>
                }
                break;
            }
            case StatusCodes.Status401Unauthorized:
            {
                <MudText Align="Align.Center" Typo="Typo.h4">Not authorized</MudText>
                <MudText Align="Align.Center" Typo="Typo.h5">Sorry, you have to be authorized to navigate this page.</MudText>
                <MudText Align="Align.Center" Typo="Typo.h5">Log in your account to come back to this page.</MudText>
                <MudLink
                    Style="text-align:center"
                    Class="d-block"
                    Typo="Typo.h5"
                    OnClick="@(async () => await ToLoginPage())">
                    Go to Login
                </MudLink>
                break;
            }
        }
    </MudItem>
</MudGrid>

@code {
    [SupplyParameterFromQuery(Name = "code")] public int Code { get; set; }
    [SupplyParameterFromQuery(Name = "returnUrl")] public string? ReturnUrl { get; set; }

    private async Task ToLoginPage()
    {
        var returnUrl = HttpUtility.UrlEncode(ReturnUrl);
        await RouteManager.NavigateAsync($"/account/login?returnUrl={returnUrl}");
    }

}
