@inject ProductValidator Validator

@if (Model.Properties.Count > 0)
{
    <MudGrid Spacing="1" Justify="Justify.Center">
        <MudItem xs="12">
            <MudTextField
                T="string"
                Value="@Model.Properties["Color"].ToString()"
                ValueChanged="@(value => OnChange("Color", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "Color")))"
                Label="Color"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                Value="@Model.Properties["Variety"].ToString()"
                ValueChanged="@(value => OnChange("Variety", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "Variety")))"
                Label="Variety"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                Value="@Model.Properties["Grade"].ToString()"
                ValueChanged="@(value => OnChange("Grade", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "Grade")))"
                Label="Grade"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                Value="@Model.Properties["CountryOfOrigin"].ToString()"
                ValueChanged="@(value => OnChange("CountryOfOrigin", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "CountryOfOrigin")))"
                Label="Country of origin"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudSelect
                T="string"
                Value="@Model.Properties["RipenessStage"].ToString()"
                ValueChanged="@(value => OnChange("RipenessStage", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "RipenessStage")))"
                Label="Ripeness stage"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
                @foreach (var stage in RipenessStages)
                {
                    <MudSelectItem Value="stage" T="string">@stage</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                Value="@Model.Properties["StorageTemperature"].ToString()"
                ValueChanged="@(value => OnChange("StorageTemperature", value))"
                Validation="@(new Func<string, IEnumerable<string>>(_ => Validator.Validate(Model, "StorageTemperature")))"
                Label="Storage temperature"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                Value="@Convert.ToBoolean(Model.Properties["RequiresRefrigeration"])"
                @onclick="@(() => OnChange("RequiresRefrigeration"))"
                Label="Requires refrigeration"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                Value="@Convert.ToBoolean(Model.Properties["ContainsSeeds"])"
                @onclick="@(() => OnChange("ContainsSeeds"))"
                Label="Contains seeds"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                Value="@Convert.ToBoolean(Model.Properties["IsTropical"])"
                @onclick="@(() => OnChange("IsTropical"))"
                Label="Tropical"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                Value="@Convert.ToBoolean(Model.Properties["IsOrganic"])"
                @onclick="@(() => OnChange("IsOrganic"))"
                Label="Organic"/>
        </MudItem>
    </MudGrid>
}

@code {
    [Parameter] public required ProductModel Model { get; set; }

    private List<string> RipenessStages { get; set; } = ["Unripe", "Partially ripe", "Ripe", "Overripe", "Spoiled"];

    protected override void OnInitialized()
    {
        Model.Properties = new()
        {
            { "Color", string.Empty },
            { "Variety", string.Empty },
            { "CountryOfOrigin", string.Empty },
            { "RipenessStage", string.Empty },
            { "StorageTemperature", string.Empty },
            { "Grade", string.Empty },
            { "RequiresRefrigeration", false },
            { "ContainsSeeds", false },
            { "IsTropical", false },
            { "IsOrganic", false },
        };
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (Model.Properties.Count > 0 && firstRender)
        {
            StateHasChanged();
        }
    }

    private void OnChange(string code, object value)
    {
        Model.Properties[code] = value;
    }

    private void OnChange(string code)
    {
        var value = Convert.ToBoolean(Model.Properties[code]);
        Model.Properties[code] = !value;
    }

}