<MudPaper Outlined="true" Class="pa-5">
    <MudStack Spacing="3">
        <MudText Typo="Typo.h6">
        Two-factor authentication (2FA)
    </MudText>
        <MudStack Spacing="4">
            @foreach (var provider in Model.Providers)
            {
                <MudStack Row="true" Spacing="1" Class="position-relative">
                    <MudText Style="padding-top: 5px"> With @provider.Name</MudText>
                    @if (provider.Subscribed)
                    {
                        <MudChip
                            T="string"
                            Size="Size.Small"
                            Variant="Variant.Outlined"
                            Color="Color.Success">
                            Enabled
                        </MudChip>
                        if (provider.UpdateDate.HasValue)
                        {
                            <MudText
                                Class="opacity-50 position-absolute"
                                Style="bottom: -15px"
                                Typo="Typo.caption">
                                Enabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                            </MudText>
                        }

                        <MudSpacer/>
                        <MudTooltip Text="Disable">
                            <MudIconButton
                                Color="Color.Error"
                                Class="pt-1"
                                Icon="@Icons.Material.Filled.Close"
                                Variant="Variant.Outlined"
                                ButtonType="ButtonType.Button"
                                OnClick="@(async () => await OnUnsubscribe.InvokeAsync(provider.Name))"/>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudChip
                            T="string"
                            Size="Size.Small"
                            Variant="Variant.Outlined"
                            Color="Color.Error">
                            Disabled
                        </MudChip>
                        if (provider.UpdateDate.HasValue)
                        {
                            <MudText
                                Class="opacity-50 position-absolute"
                                Style="bottom: -18px"
                                Typo="Typo.caption">
                                Disabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                            </MudText>
                        }

                        <MudSpacer/>
                        <MudTooltip Text="Enable">
                            <MudIconButton
                                Color="Color.Success"
                                Class="pt-1"
                                Icon="@Icons.Material.Filled.Check"
                                Variant="Variant.Outlined"
                                ButtonType="ButtonType.Button"
                                OnClick="@(async () => await OnSubscribe.InvokeAsync(provider.Name))"/>
                        </MudTooltip>
                    }
                </MudStack>
            }
        </MudStack>
        @if (Model.Providers.Any(x => x.Subscribed))
        {
            <MudStack Spacing="1" Row="true">
                @if (Model.Providers.Any(x => x is { Name: ProviderTypes.Authenticator, Subscribed: true }))
                {
                    <MudButton
                        Color="Color.Primary"
                        Variant="Variant.Filled"
                        ButtonType="ButtonType.Button"
                        OnClick="@(async () => await OnGenerateCodes.InvokeAsync())">
                        Generate recovery codes
                    </MudButton>
                }
            </MudStack>
        }
    </MudStack>
</MudPaper>

@code {
    [Parameter] public UserModel Model { get; set; } = new();
    [Parameter] public EventCallback<string> OnSubscribe { get; set; }
    [Parameter] public EventCallback<string> OnUnsubscribe { get; set; }
    [Parameter] public EventCallback OnGenerateCodes { get; set; }
}