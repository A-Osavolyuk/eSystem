<MudCard Outlined="true" Class="pa-3">
    <MudCardHeader Class="e-card-header">
        <MudText Typo="Typo.h5">
            Two-factor authentication (2FA)
        </MudText>
    </MudCardHeader>
    <MudCardContent Class="e-card-content">
        <MudGrid Spacing="3">
            <MudItem xs="12">
                <MudText Class="pt-2" Typo="Typo.h6">
                    Providers
                </MudText>
                <MudDivider/>
            </MudItem>
            @if (Model.Providers.Count > 0)
            {
                foreach (var provider in Model.Providers)
                {
                    <MudItem xs="12" Class="mt-2">
                        <MudGrid Spacing="1">
                            <MudItem xs="3" Class="pt-1 position-relative">
                                <MudText> With @provider.Name</MudText>
                                @if (provider.UpdateDate.HasValue)
                                {
                                    if (provider.Subscribed)
                                    {
                                        <MudText
                                            Class="opacity-50 position-absolute"
                                            Style="bottom: -18px"
                                            Typo="Typo.caption">
                                            Enabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                                        </MudText>
                                    }
                                    else
                                    {
                                        <MudText
                                            Class="opacity-50 position-absolute"
                                            Style="bottom: -18px"
                                            Typo="Typo.caption">
                                            Disabled at: @provider.UpdateDate?.ToString("MM/dd/yyyy HH:mm")
                                        </MudText>
                                    }
                                }
                            </MudItem>
                            <MudItem xs="9" Class="pt-0">
                                @if (provider.Subscribed)
                                {
                                    <MudStack Row="true">
                                        <MudText Class="pt-1" Color="Color.Success">Enabled</MudText>
                                        <MudSpacer/>
                                        <MudTooltip Text="Disable">
                                            <MudIconButton
                                                Color="Color.Error"
                                                Class="pt-1"
                                                Icon="@Icons.Material.Filled.Close"
                                                Variant="Variant.Outlined"
                                                ButtonType="ButtonType.Button"
                                                OnClick="@(async () => await OnUnsubscribe.InvokeAsync(provider.Name))"/>
                                        </MudTooltip>
                                    </MudStack>
                                }
                                else
                                {
                                    <MudStack Row="true">
                                        <MudText Class="pt-1" Color="Color.Error">Disabled</MudText>
                                        <MudSpacer/>
                                        <MudTooltip Text="Enable">
                                            <MudIconButton
                                                Color="Color.Primary"
                                                Class="pt-1"
                                                Icon="@Icons.Material.Filled.Check"
                                                Variant="Variant.Filled"
                                                ButtonType="ButtonType.Button"
                                                OnClick="@(async () => await OnSubscribe.InvokeAsync(provider.Name))"/>
                                        </MudTooltip>
                                    </MudStack>
                                }
                            </MudItem>
                            @if (provider != Model.Providers.Last())
                            {
                                <MudItem xs="12" Class="pt-4">
                                    <MudDivider/>
                                </MudItem>
                            }
                        </MudGrid>
                    </MudItem>
                }
            }
        </MudGrid>
    </MudCardContent>
    @if (Model.Providers.Any(x => x.Subscribed))
    {
        <MudCardActions>
            <MudStack Spacing="1" Row="true">
                @if (Model.Providers.Any(x => x is { Name: ProviderTypes.Authenticator, Subscribed: true }))
                {
                    <MudButton
                        Color="Color.Primary"
                        Variant="Variant.Filled"
                        ButtonType="ButtonType.Button"
                        OnClick="@(async () => await OnGenerateCodes.InvokeAsync())">
                        Generate recovery codes
                    </MudButton>
                }
            </MudStack>
        </MudCardActions>
    }
</MudCard>

@code {
    [Parameter] public UserModel Model { get; set; } = new();
    [Parameter] public EventCallback<string> OnSubscribe { get; set; }
    [Parameter] public EventCallback<string> OnUnsubscribe { get; set; }
    [Parameter] public EventCallback OnGenerateCodes { get; set; }
}