@using eShop.Infrastructure.Routing

@inject RouteManager RouteManager

<MudPaper Outlined="true" Class="pa-5">
    <MudStack Spacing="3">
        <MudText Typo="Typo.h6">
            Account recovery
        </MudText>
        <MudStack Spacing="0">
            <MudStack Spacing="1" Row="true">
                <MudText Typo="Typo.h6">
                    Recovery email
                </MudText>
                <MudSpacer/>
                @if (string.IsNullOrEmpty(Model.RecoveryEmail))
                {
                    <MudTooltip Text="Add recovery email">
                        <MudIconButton
                            Icon="@Icons.Material.Filled.Add"
                            Color="Color.Primary"
                            Variant="Variant.Filled"
                            OnClick="@(async () => await OnAdd.InvokeAsync())"/>
                    </MudTooltip>
                }
                else
                {
                    <MudTooltip Text="Remove phone number">
                        <MudIconButton
                            Icon="@Icons.Material.Filled.Delete"
                            Color="Color.Error"
                            Variant="Variant.Filled"
                            OnClick="@(async () => await OnRemove.InvokeAsync())"/>
                    </MudTooltip>
                    <MudTooltip Text="Change recovery email">
                        <MudIconButton
                            Icon="@Icons.Material.Filled.Edit"
                            Color="Color.Primary"
                            Variant="Variant.Filled"
                            OnClick="@(async () => await OnChange.InvokeAsync())"/>
                    </MudTooltip>
                }
            </MudStack>
            <MudStack Row="true" Spacing="1">
                @if (!string.IsNullOrEmpty(Model.RecoveryEmail))
                {
                    if (Model is { RecoveryEmailConfirmed: true, RecoveryEmailConfirmationDate: not null })
                    {
                        <MudText Style="padding-top: 5px">@Model.RecoveryEmail</MudText>
                        <MudTooltip
                            Text="@($"Verified at: {Model.RecoveryEmailConfirmationDate?.ToString("MM/dd/yyyy HH:mm")}")">
                            <MudChip
                                Class="mx-0"
                                T="string"
                                Color="Color.Success"
                                Variant="Variant.Outlined"
                                Size="Size.Small">
                                Verified
                            </MudChip>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudChip
                            Class="mx-0"
                            T="string"
                            Color="Color.Error"
                            Variant="Variant.Outlined"
                            Size="Size.Small">
                            Unverified
                        </MudChip>
                    }
                    
                    if (Model.RecoveryEmailChangeDate is not null)
                    {
                        <MudTooltip Text="@($"Last change: {Model.RecoveryEmailChangeDate?.ToString("MM/dd/yyyy HH:mm")}")">
                            <MudChip
                                T="string"
                                Class="mx-0"
                                Color="Color.Warning"
                                Variant="Variant.Outlined"
                                Size="Size.Small">
                                Changed
                            </MudChip>
                        </MudTooltip>
                    }
                }
            </MudStack>
            @if (!string.IsNullOrEmpty(Model.RecoveryEmail))
            {
                <MudText Class="opacity-50" Typo="Typo.caption">
                    Recovery email will be sent to this email address.
                </MudText>
            }
            else
            {
                <MudText Class="opacity-50" Typo="Typo.caption">
                    Recovery email was not provided. You can add it by click button right.
                </MudText>
            }
        </MudStack>
        <MudStack Spacing="1" Row="true">
            <MudButton
                Color="Color.Primary"
                Variant="Variant.Filled"
                ButtonType="ButtonType.Button"
                OnClick="@(async () => await OnGenerateCodes.InvokeAsync())">
                Generate recovery codes
            </MudButton>
        </MudStack>
    </MudStack>
</MudPaper>

@code {
    [Parameter] public UserSecurityModel Model { get; set; } = new();
    [Parameter] public EventCallback OnGenerateCodes { get; set; }
    [Parameter] public EventCallback OnAdd { get; set; }
    [Parameter] public EventCallback OnRemove { get; set; }
    [Parameter] public EventCallback OnChange { get; set; }
}