@using eShop.Infrastructure.Routing

@inject RouteManager RouteManager

<MudStack Spacing="2">
    <MudPaper Outlined="true" Class="pt-3 pl-5 pr-5 pb-2">
        <MudStack Spacing="0">
            <MudStack Row="true">
                <MudText Typo="Typo.h6">
                    Username
                </MudText>
                <MudSpacer/>
                <MudTooltip Text="Change username">
                    <MudIconButton
                        Icon="@Icons.Material.Filled.Edit"
                        Color="Color.Primary"
                        Variant="Variant.Filled"
                        OnClick="@(async () => await OnChangeUsername.InvokeAsync())"/>
                </MudTooltip>
            </MudStack>
            <MudStack Row="true" Spacing="1">
                <MudText Style="padding-top: 5px">@Model.UserName</MudText>
                <MudChip Class="mx-0" T="string" Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
                    Unique
                </MudChip>
                @if (Model.UserNameChangeDate is not null)
                {
                    <MudTooltip Text="@($"Last change: {Model.UserNameChangeDate?.ToString("MM/dd/yyyy HH:mm")}")">
                        <MudChip
                            T="string"
                            Class="mx-0"
                            Color="Color.Warning"
                            Variant="Variant.Outlined"
                            Size="Size.Small">
                            Changed
                        </MudChip>
                    </MudTooltip>
                }
            </MudStack>
            <MudText Class="opacity-50" Typo="Typo.caption">
                This username will be shown for other users.
            </MudText>
        </MudStack>
    </MudPaper>
    <MudPaper Outlined="true" Class="pt-3 pl-5 pr-5 pb-2">
        <MudStack Spacing="0">
            <MudStack Row="true">
                <MudText Typo="Typo.h6">
                    Email
                </MudText>
                <MudSpacer/>
                <MudTooltip Text="Change email">
                    <MudIconButton
                        Icon="@Icons.Material.Filled.Edit"
                        Color="Color.Primary"
                        Variant="Variant.Filled"
                        OnClick="@(() => RouteManager.NavigateAsync("/account/email/change"))"/>
                </MudTooltip>
            </MudStack>
            <MudStack Row="true" Spacing="1">
                <MudText Style="padding-top: 5px">@Model.Email</MudText>
                <MudChip Class="mx-0" T="string" Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">
                    Primary
                </MudChip>
                @if (Model.EmailConfirmed && Model.EmailConfirmationDate.HasValue)
                {
                    <MudTooltip Text="@($"Verified at: {Model.EmailConfirmationDate?.ToString("MM/dd/yyyy HH:mm")}")">
                        <MudChip
                            Class="mx-0"
                            T="string"
                            Color="Color.Success"
                            Variant="Variant.Outlined"
                            Size="Size.Small">
                            Verified
                        </MudChip>
                    </MudTooltip>
                }
                else
                {
                    <MudChip
                        Class="mx-0"
                        T="string"
                        Color="Color.Error"
                        Variant="Variant.Outlined"
                        Size="Size.Small">
                        Unverified
                    </MudChip>
                }
                @if (Model.EmailChangeDate is not null)
                {
                    <MudTooltip Text="@($"Last change: {Model.EmailChangeDate?.ToString("MM/dd/yyyy HH:mm")}")">
                        <MudChip
                            T="string"
                            Class="mx-0"
                            Color="Color.Warning"
                            Variant="Variant.Outlined"
                            Size="Size.Small">
                            Changed
                        </MudChip>
                    </MudTooltip>
                }
            </MudStack>
            <MudText Class="opacity-50" Typo="Typo.caption">
                Notifications will be sent to this email address.
            </MudText>
        </MudStack>
    </MudPaper>
    <MudPaper Outlined="true" Class="pt-3 pl-5 pr-5 pb-2">
        <MudStack Spacing="0">
            <MudStack Row="true" Spacing="1">
                <MudText Typo="Typo.h6">
                    Phone number
                </MudText>
                <MudSpacer/>
                @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                {
                    if (Model.PhoneNumberConfirmed)
                    {
                        <MudTooltip Text="Remove phone number">
                            <MudIconButton
                                Icon="@Icons.Material.Filled.Delete"
                                Color="Color.Error"
                                Variant="Variant.Filled"
                                OnClick="@(async () => await OnRemovePhoneNumber.InvokeAsync())"/>
                        </MudTooltip>
                        <MudTooltip Text="Change phone number">
                            <MudIconButton
                                Icon="@Icons.Material.Filled.Edit"
                                Color="Color.Primary"
                                Variant="Variant.Filled"
                                OnClick="@(() => RouteManager.NavigateAsync("/account/phone-number/change"))"/>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudTooltip Text="Verify phone number">
                            <MudIconButton
                                Icon="@Icons.Material.Filled.Check"
                                Color="Color.Primary"
                                Variant="Variant.Filled"
                                OnClick="@(() => RouteManager.NavigateAsync("/account/phone-number/verify"))"/>
                        </MudTooltip>
                    }
                }
                else
                {
                    <MudTooltip Text="Add phone number">
                        <MudIconButton
                            Icon="@Icons.Material.Filled.Add"
                            Color="Color.Primary"
                            Variant="Variant.Filled"
                            OnClick="@(() => RouteManager.NavigateAsync("/account/phone-number/add"))"/>
                    </MudTooltip>
                }
            </MudStack>
            @if (!string.IsNullOrEmpty(Model.PhoneNumber))
            {
                <MudStack Row="true" Spacing="1">
                    <MudText Style="padding-top: 5px">@Model.PhoneNumber</MudText>
                    @if (Model is { PhoneNumberConfirmed: true, PhoneNumberConfirmationDate: not null })
                    {
                        <MudTooltip
                            Text="@($"Confirmed at: {Model.PhoneNumberConfirmationDate?.ToString("MM/dd/yyyy HH:mm")}")">
                            <MudChip
                                T="string"
                                Class="mx-0"
                                Color="Color.Success"
                                Variant="Variant.Outlined"
                                Size="Size.Small">
                                Verified
                            </MudChip>
                        </MudTooltip>
                    }
                    else
                    {
                        <MudChip
                            T="string"
                            Class="mx-0"
                            Color="Color.Error"
                            Variant="Variant.Outlined"
                            Size="Size.Small">
                            Unverified
                        </MudChip>
                    }
                    @if (Model.PhoneNumberChangeDate is not null)
                    {
                        <MudTooltip
                            Text="@($"Last change: {Model.PhoneNumberChangeDate?.ToString("MM/dd/yyyy HH:mm")}")">
                            <MudChip
                                T="string"
                                Class="mx-0"
                                Color="Color.Warning"
                                Variant="Variant.Outlined"
                                Size="Size.Small">
                                Changed
                            </MudChip>
                        </MudTooltip>
                    }
                </MudStack>
                <MudText Class="opacity-50" Typo="Typo.caption">
                    SMS messages will be sent to this phone number.
                </MudText>
            }
            else
            {
                <MudText Class="opacity-50" Typo="Typo.caption">
                    Phone number was not provided. You can add it by click button right.
                </MudText>
            }
        </MudStack>
    </MudPaper>
</MudStack>

@code {
    [Parameter] public UserModel Model { get; set; } = new();
    [Parameter] public EventCallback OnChangeUsername { get; set; }
    [Parameter] public EventCallback OnRemovePhoneNumber { get; set; }
    [Parameter] public EventCallback OnAddPhoneNumber { get; set; }
    [Parameter] public EventCallback OnChangePhoneNumber { get; set; }
    [Parameter] public EventCallback OnVerifyPhoneNumber { get; set; }
}