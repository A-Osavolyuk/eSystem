@page "/account/oauth/fallback"

@inherits PageBase

<Title Text="OAuth fallback"/>

<MudGrid Justify="Justify.Center">
    <MudItem xs="6">
        <MudStack Spacing="3">
            <MudText Typo="Typo.h4" Align="Align.Center">
                @Model.Title
            </MudText>
            @if (string.IsNullOrEmpty(Model.Message))
            {
                <MudText Typo="Typo.h6" Align="Align.Center">
                    @Model.Message
                </MudText>
            }
        </MudStack>
    </MudItem>
</MudGrid>

@code {

    [SupplyParameterFromQuery(Name = "provider")] public string? Provider { get; set; } = string.Empty;
    [SupplyParameterFromQuery(Name = "errorCode")] public string ErrorCode { get; set; } = string.Empty;
    [SupplyParameterFromQuery(Name = "message")] public string? Message { get; set; } = string.Empty;

    private OAuthFallbackModel Model { get; set; } = new();

    protected override void OnInitialized()
    {
        var errorCode = (OAuthErrorType)Enum.Parse(typeof(OAuthErrorType), ErrorCode);

        if (!string.IsNullOrEmpty(Message))
        {
            var message = Uri.UnescapeDataString(Message);
            Model.Message = message;
        }

        Model.Title = errorCode switch
        {
            OAuthErrorType.InternalError => $"Internal error while authenticate with {Provider}",
            OAuthErrorType.InvalidCredentials => $"Invalid credentials while authenticate with {Provider}",
            OAuthErrorType.RemoteError => $"Remote error while authenticate with {Provider}",
            OAuthErrorType.TemporarilyUnavailable => $"Authentication with {Provider} is temporary unavailable",
            OAuthErrorType.Unavailable => $"Authentication with {Provider} is unavailable",
            OAuthErrorType.UnsupportedProvider => $"Authentication with {Provider} is not supported",
            _ => throw new NotSupportedException("Unsupported error type")
        };
    }

}