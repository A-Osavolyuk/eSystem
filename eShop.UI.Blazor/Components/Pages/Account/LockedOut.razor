@page "/account/locked-out"

@inherits PageBase

@inject IUsersService UsersService

<MudGrid Justify="Justify.Center">
    <MudItem xs="4">
        <MudStack Spacing="1" Justify="Justify.Center">
            @if (Model.Reason is not null)
            {
                <MudPaper Outlined="true" Class="pa-3" Style="margin-top: 150px">
                    <MudText Typo="Typo.h6">
                        @Model.Reason.Name
                    </MudText>
                </MudPaper>
                <MudPaper Outlined="true" Class="pa-3">
                    <MudGrid Justify="Justify.Center" Spacing="1">
                        <MudItem xs="12">
                            <MudText Typo="Typo.subtitle1">
                                @Model.Description
                            </MudText>
                        </MudItem>
                        <MudItem xs="12">
                            @if (Model.Permanent)
                            {
                                <MudText Typo="Typo.subtitle1" Align="Align.Center">
                                    Locked out permanently
                                </MudText>
                            }
                            else
                            {
                                <MudText Typo="Typo.subtitle1" Align="Align.Center">
                                    Locked out until: @Model.EndDate
                                </MudText>
                            }
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            }
        </MudStack>
    </MudItem>
</MudGrid>

@code {

    [SupplyParameterFromQuery(Name = "id")]
    public Guid Id { get; set; }

    private LockoutModel Model { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var result = await UsersService.GetLockoutStateAsync(Id);

        if (result.Success)
        {
            var response = result.Get<LockoutStateDto>()!;
            Model = Mapper.Map(response);
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error);
        }
    }

}