@using eShop.Domain.Common.Security.Constants
@inject IProvidersService ProvidersService
@inject ISnackbar Snackbar

<MudDialog Style="width: 600px">
    <TitleContent>
        Disable 2FA with @Provider
    </TitleContent>
    <DialogContent>
        @switch (Provider)
        {
            case ProviderTypes.Email:
                <MudText Align="Align.Left">
                    Are you sure you want to disable Two-Factor Authentication (2FA) via email?
                    If you disable it, you'll need to enable it again to use email-based 2FA in the future.
                </MudText>
                break;
                
            case ProviderTypes.Sms:
                <MudText Align="Align.Left">
                    Are you sure you want to disable Two-Factor Authentication (2FA) via SMS?
                    If you disable it, you'll need to enable it again to use SMS-based 2FA in the future.
                </MudText>
                break;
                
            case ProviderTypes.Authenticator:
                <MudText Align="Align.Left">
                    Are you sure you want to disable Two-Factor Authentication (2FA) via authenticator app?
                    If you disable it, you'll need to enable it again to use authenticator app-based 2FA in the future.
                </MudText>
                break;
        }
    </DialogContent>
    <DialogActions>
        <MudStack Row="true" Spacing="1">
            <MudButton
                Color="Color.Info"
                Variant="Variant.Outlined"
                ButtonType="ButtonType.Button"
                OnClick="@(() => OnCancel())">
                Cancel
            </MudButton>
            <MudButton
                Color="Color.Error"
                Variant="Variant.Filled"
                ButtonType="ButtonType.Button"
                OnClick="@(async () => await OnSubmitAsync())">
                Submit
            </MudButton>
        </MudStack>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IMudDialogInstance? Dialog { get; set; }
    [Parameter] public string Provider { get; set; } = string.Empty;
    [Parameter] public Guid UserId { get; set; }

    private async Task OnSubmitAsync()
    {
        var request = new UnsubscribeProviderRequest()
        {
            UserId = UserId,
            Provider = Provider
        };

        var result = await ProvidersService.UnsubscribeAsync(request);

        if (result.Success)
        {
            Dialog?.Close(DialogResult.Ok(true));
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error);
        }
    }
    
    private void OnCancel() => Dialog?.Cancel();
}