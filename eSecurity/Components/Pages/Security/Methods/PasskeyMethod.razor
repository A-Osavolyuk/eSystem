@using eSecurity.Common.DTOs
@using eSecurity.Security.Authentication.TwoFactor
<MudStack Row="true" Class="px-5">
    <MudIcon Icon="@Icons.Material.Outlined.Lock" Size="Size.Medium" Class="mt-1"/>
    <MudStack Spacing="0">
        <MudStack Row="true" Spacing="1">
            <MudTextM3 Typo="TypoM3.Title" Size="Size.Medium" Class="fw-bold pt-1">
                Secure keys
            </MudTextM3>
            @if (Model.PasskeyEnabled)
            {
                <MudChip
                    T="string"
                    Class="mx-0"
                    Size="Size.Small"
                    Color="Color.Success"
                    Variant="Variant.Outlined">
                    Configured
                </MudChip>
            }
            else
            {
                <MudChip
                    T="string"
                    Class="mx-0"
                    Size="Size.Small"
                    Color="Color.Error"
                    Variant="Variant.Outlined">
                    Not configured
                </MudChip>
            }
            @if (Model.PreferredMethod == TwoFactorMethod.Passkey)
            {
                <MudChip
                    T="string"
                    Class="mx-0"
                    Size="Size.Small"
                    Color="Color.Info"
                    Variant="Variant.Outlined">
                    Preferred
                </MudChip>
            }
        </MudStack>
        <MudTextM3 Typo="TypoM3.Body" Size="Size.Small" Class="opacity-50">
            Security keys are webauthn credentials that can
            only be used as a second factor of authentication.
        </MudTextM3>
    </MudStack>
    <MudSpacer/>
    <MudStack>
        @if (Model.PasskeyEnabled)
        {
            <MudButton
                ButtonType="ButtonType.Button"
                Variant="Variant.Outlined"
                Size="Size.Small">
                Edit
            </MudButton>
        }
        else
        {
            <MudButton
                ButtonType="ButtonType.Button"
                Variant="Variant.Outlined"
                Size="Size.Small"
                Href="@(OnAddPasskey())">
                Add
            </MudButton>
        }
    </MudStack>
</MudStack>

@code {
    [Parameter] public TwoFactorData Model { get; set; } = new();
    
    private string OnAddPasskey() => QueryBuilder.Create()
        .WithUri(Links.Account.PasskeyAddPage)
        .WithQueryParam("return_url", Links.Account.SecurityPage)
        .Build();
}