@inject IUsersService UsersService
@inject ISnackbar Snackbar
@inject ChangeUserNameValidator Validator

<MudDialog Style="width: 600px">
    <TitleContent>
        Username change
    </TitleContent>
    <DialogContent>
        <MudForm Model="Model" Validation="Validator.ValidateValue">
            <MudTextField
                @bind-Value="Model.UserName"
                For="() => Model.UserName"
                Label="Username"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true"/>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton
            Color="Color.Error"
            Variant="Variant.Filled"
            ButtonType="ButtonType.Button"
            OnClick="() => OnCancel()">
            Cancel
        </MudButton>
        <MudButton
            Color="Color.Primary"
            Variant="Variant.Filled"
            ButtonType="ButtonType.Button"
            OnClick="async () => await OnSubmitAsync()">
            Change
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] public IMudDialogInstance? Dialog { get; set; }
    [Parameter] public ChangeUserNameModel Model { get; set; } = new();

    private async Task OnSubmitAsync()
    {
        var request = Mapper.Map(Model);
        var result = await UsersService.ChangeUsernameAsync(request);

        if (result.Success)
        {
            Dialog?.Close(DialogResult.Ok(true));
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error);
        }
    }
    
    private void OnCancel() => Dialog?.Close();
}