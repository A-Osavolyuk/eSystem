@using eSecurity.Client.Security.Authorization.Access.Verification

@inject ISnackbar Snackbar
@inject IVerificationService VerificationService

@if (Context is not null)
{
    if (Context.Sender == SenderType.Email)
    {
        <MudTextM3 Align="Align.Center" Typo="TypoM3.Body" Size="Size.Medium">
            Didn't received an email?
            <MudLink Typo="Typo.body2" OnClick="@(async () => await ResendCodeAsync())">
                Resend
            </MudLink>
        </MudTextM3>
    }
    else if (Context.Sender == SenderType.Sms)
    {
        <MudTextM3 Align="Align.Center" Typo="TypoM3.Body" Size="Size.Medium">
            Didn't received a SMS?
            <MudLink Typo="Typo.body2" OnClick="@(async () => await ResendCodeAsync())">
                Resend
            </MudLink>
        </MudTextM3>
    }
}

@code {
    [Parameter] public MessageContext? Context { get; set; } = new();

    private async Task ResendCodeAsync()
    {
        var request = new ResendCodeRequest
        {
            UserId = Context!.UserId,
            Payload = Context!.Payload,
            Purpose = Context!.Purpose,
            Sender = Context!.Sender,
            Action = Context!.Action
        };

        var result = await VerificationService.ResendCodeAsync(request);
        if (!result.Succeeded) Snackbar.Add(result.GetError().Description, Severity.Error);
    }

}