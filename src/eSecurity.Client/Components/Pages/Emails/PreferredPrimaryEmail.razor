@inject NavigationManager NavigationManager

<MudPaper Elevation="4" Class="pa-5">
    <MudGrid Justify="Justify.Center">
        <MudItem xs="8">
            <MudStack Spacing="1">
                <MudTextM3 Typo="TypoM3.Title" Size="Size.Medium" Class="fw-bold">
                    Primary email address
                </MudTextM3>
                <MudTextM3 Typo="TypoM3.Body" Size="Size.Small" Class="opacity-50">
                    Select an email to be used for account-related
                    notifications and can be used for password reset.
                </MudTextM3>
            </MudStack>
        </MudItem>
        <MudItem xs="4">
            <MudSelectExtended
                T="string"
                Margin="Margin.Dense"
                AnchorOrigin="Origin.BottomCenter"
                Value="@Model.PrimaryEmail?.Email"
                ValueChanged="OnChange"
                Variant="Variant.Outlined"
                Immediate="true">
                @foreach (var email in Model.Emails)
                {
                    <MudSelectItemExtended T="string" Value="email.Email">
                        @email.Email
                    </MudSelectItemExtended>
                }
            </MudSelectExtended>
        </MudItem>
    </MudGrid>
</MudPaper>

@code{
    [Parameter] public UserEmailsModel Model { get; set; } = null!;

    private void OnChange(string email)
    {
        var builder = QueryBuilder.Create()
            .WithUri(Links.Account.EmailManagePage)
            .WithQueryParam("email", email)
            .WithQueryParam("type", EmailTypes.Primary)
            .WithQueryParam("return_url", Links.Settings.Emails);
        
        NavigationManager.NavigateTo(builder.Build());
    }

}