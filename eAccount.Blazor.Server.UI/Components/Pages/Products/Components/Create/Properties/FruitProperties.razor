@using eAccount.Blazor.Server.Application.Validation.Products
@using eAccount.Blazor.Server.Domain.Models.Products
@inject FruitPropertiesValidator Validator

@if (Model.Properties is FruitPropertiesModel properties)
{
    <MudGrid Spacing="1" Justify="Justify.Center">
        <MudItem xs="12">
            <MudTextField
                T="string"
                @bind-Value="properties.Color"
                For="() => properties.Color"
                Validation="Validator.ValidateValue"
                Label="Color"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                @bind-Value="properties.Variety"
                For="() => properties.Variety"
                Validation="Validator.ValidateValue"
                Label="Variety"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                @bind-Value="properties.Grade"
                For="() => properties.Grade"
                Validation="Validator.ValidateValue"
                Label="Grade"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                @bind-Value="properties.CountryOfOrigin"
                For="() => properties.CountryOfOrigin"
                Validation="Validator.ValidateValue"
                Label="Country of origin"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="12">
            <MudSelect
                T="string"
                @bind-Value="properties.RipenessStage"
                For="() => properties.RipenessStage"
                Validation="Validator.ValidateValue"
                Label="Ripeness stage"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
                @foreach (var stage in RipenessStages)
                {
                    <MudSelectItem Value="stage" T="string">@stage</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12">
            <MudTextField
                T="string"
                @bind-Value="properties.StorageTemperature"
                For="() => properties.StorageTemperature"
                Validation="Validator.ValidateValue"
                Label="Storage temperature"
                Variant="Variant.Outlined"
                Immediate="true"
                Clearable="true">
            </MudTextField>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                @bind-Value="properties.RequiresRefrigeration"
                Label="Requires refrigeration"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                @bind-Value="properties.ContainsSeeds"
                Label="Contains seeds"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                @bind-Value="properties.IsTropical"
                Label="Tropical"/>
        </MudItem>
        <MudItem xs="6" Class="text-start">
            <MudCheckBox
                @bind-Value="properties.IsOrganic"
                Label="Organic"/>
        </MudItem>
    </MudGrid>
}

@code {
    [Parameter] public required ProductModel Model { get; set; }

    private List<string> RipenessStages { get; set; } = ["Unripe", "Partially ripe", "Ripe", "Overripe", "Spoiled"];

    protected override void OnInitialized()
    {
        Model.Properties = new FruitPropertiesModel();
    }
    
    protected override void OnAfterRender(bool firstRender)
    {
        if (Model.Properties is not null && firstRender)
        {
            StateHasChanged();
        }
    }
}